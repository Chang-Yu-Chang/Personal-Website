---
title: 'Generalized Birthday Problem: Rcpp'
author: Chang-Yu Chang
date: '2018-03-30'
slug: generalized-birthday-problem-rcpp
categories:
  - R
tags:
  - academic
  - fun
  - R
---



<p>In the previous <a href="https://changyuchang.netlify.com/post/generalized-birthday-problem/">post</a>, I tried to use some algorithms to speed up simulation. Now in this post, I will introduce a pretty powerful package <code>Rcpp</code>, which has the potential to fundementally change the way you do simulation if you want to employ a time-consuming simulation in R. Letâ€™s finish this project!</p>
<ul>
<li><p><a href="https://changyuchang.netlify.com/post/generalized-birthday-problem-rcpp/#rcpp">Rcpp</a></p></li>
<li><p><a href="">Generalized Birthday Problem package</a></p></li>
</ul>
<div id="rcpp" class="section level3">
<h3>Rcpp</h3>
<p><code>Rcpp</code> is basically a package that incorporates C++ code in R. For me, using <code>Rcpp</code> means my code can work faster while I can still enjoy the convenience of many versatile R packages. A simple way to use <code>Rcpp</code> is the function <code>cppFunction</code>. C++ code comes in as text in your R script. In this example, I define the function <code>simulateC</code>, which simulates and calculate the probility of a birthday shared by at least <em>k</em> persons in a room size of <em>room</em> (sorry for inconsistent notation, but I prefer i as index in a loop). I am totally not an expert in C++ (this script is my first C++ script, to be honest), so this is just to give a taste of how fast a function through <code>Rcpp</code> can be.</p>
<pre class="r"><code>install.packages(&#39;Rcpp&#39;)</code></pre>
<pre class="r"><code>library(Rcpp)</code></pre>
<pre><code>## Warning: package &#39;Rcpp&#39; was built under R version 3.4.3</code></pre>
<pre class="r"><code>cppFunction(&#39;
#include &lt;Rcpp.h&gt;
using namespace Rcpp;
// [[Rcpp::export]]
float simulateC (int k, int room, int replicate) {
  IntegerVector result (replicate); 
  for (int r=0; r&lt;replicate; r++){
    IntegerVector counts(365);
    for (int i=0; i&lt;room; i++) {
      int pos = rand() % 365;
      if (pos &lt; 365 &amp;&amp; pos &gt;= 0) counts[pos] ++;
    } 
    if (max(counts) &gt;= k) {
      result[r] = TRUE;
    } else result[r] = FALSE;
  }
  float prob = float(sum(result))/float(replicate);
  return prob;
}
&#39;)</code></pre>
<pre><code>## Warning: No function found for Rcpp::export attribute at
## file82e0eacb75f.cpp:5</code></pre>
<pre class="r"><code>library(rbenchmark)

system.time({
  y &lt;- simulateC(k=2, room=23, replicate=1e5) 
})</code></pre>
<pre><code>##    user  system elapsed 
##   0.074   0.006   0.080</code></pre>
<pre class="r"><code>y</code></pre>
<pre><code>## [1] 0.50457</code></pre>
</div>
